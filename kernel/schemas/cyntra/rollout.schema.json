{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://cyntra/schemas/cyntra/rollout.schema.json",
  "title": "Cyntra Rollout",
  "description": "Normalized rollout summary derived from manifest + proof + telemetry",
  "type": "object",
  "required": [
    "schema_version",
    "rollout_id",
    "issue_id",
    "job_type",
    "policy",
    "inputs",
    "trajectory",
    "outcomes",
    "scores"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "cyntra.rollout.v1"
    },
    "rollout_id": { "type": "string" },
    "workcell_id": { "type": "string" },
    "issue_id": { "type": "string" },
    "job_type": { "type": "string" },
    "policy": {
      "type": "object",
      "required": ["toolchain", "sampling", "speculate"],
      "properties": {
        "toolchain": { "type": "string" },
        "model": { "type": ["string", "null"] },
        "prompt_genome_id": { "type": ["string", "null"] },
        "sampling": {
          "type": "object",
          "properties": {
            "temperature": { "type": ["number", "null"] },
            "top_p": { "type": ["number", "null"] }
          },
          "additionalProperties": false
        },
        "speculate": {
          "type": "object",
          "properties": {
            "enabled": { "type": "boolean" },
            "parallelism": { "type": ["integer", "null"] },
            "tag": { "type": ["string", "null"] }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "inputs": {
      "type": "object",
      "required": ["manifest_path"],
      "properties": {
        "manifest_path": { "type": "string" },
        "repo_commit_base": { "type": ["string", "null"] },
        "repo_commit_head": { "type": ["string", "null"] }
      },
      "additionalProperties": true
    },
    "trajectory": {
      "type": "object",
      "required": ["telemetry_path", "tool_summary", "file_changes"],
      "properties": {
        "telemetry_path": { "type": "string" },
        "telemetry_missing_reason": { "type": ["string", "null"] },
        "tool_summary": {
          "type": "object",
          "additionalProperties": { "type": "integer" }
        },
        "file_changes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["path", "kind"],
            "properties": {
              "path": { "type": "string" },
              "kind": { "type": "string" }
            },
            "additionalProperties": false
          }
        },
        "commands_executed": {
          "type": "array",
          "items": { "type": "object" }
        }
      },
      "additionalProperties": true
    },
    "outcomes": {
      "type": "object",
      "required": ["verification"],
      "properties": {
        "verification": {
          "type": "object",
          "required": ["all_passed", "blocking_failures"],
          "properties": {
            "all_passed": { "type": "boolean" },
            "blocking_failures": {
              "type": "array",
              "items": { "type": "string" }
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "scores": {
      "type": "object",
      "required": ["risk", "diff_lines"],
      "properties": {
        "risk": { "type": "string" },
        "diff_lines": { "type": "integer" },
        "cost_usd": { "type": ["number", "null"] },
        "duration_ms": { "type": ["integer", "null"] }
      },
      "additionalProperties": true
    },
    "planner": { "type": "object" },
    "artifacts": { "type": "object" },
    "generated_at": { "type": "string", "format": "date-time" }
  },
  "additionalProperties": false
}
