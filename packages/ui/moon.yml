$schema: "https://moonrepo.dev/schemas/project.json"

language: "typescript"
type: "library"
stack: "frontend"
platform: "bun"

project:
  name: "@oos/ui"
  description: "Futuristic UI component library with HUD-inspired design and neon accents"
  owner: "frontend-team"
  maintainers: ["frontend-team"]
  channel: "#frontend"

fileGroups:
  sources:
    - "src/**/*"
  configs:
    - "*.config.*"
    - "tsconfig.json"
    - ".storybook/**/*"
  tests:
    - "src/**/*.test.*"
    - "src/**/*.spec.*"
    - "src/**/*.stories.*"
  assets:
    - "public/**/*"

env:
  NODE_ENV: "development"
  STORYBOOK_DISABLE_TELEMETRY: "1"

tasks:
  # Development tasks
  dev:
    command: "bun run tsup --watch"
    local: true
    deps:
      - "install"
    options:
      persistent: true
    inputs:
      - "@globs(sources)"
      - "@globs(configs)"
    outputs:
      - "dist"

  story:
    command: "bun run storybook dev -p 6006"
    local: true
    options:
      persistent: true
    inputs:
      - "@globs(sources)"
      - "@globs(configs)"
      - "@globs(tests)"
    outputs: []

  # Build tasks
  build:
    command: "bun run tsup"
    inputs:
      - "@globs(sources)"
      - "@globs(configs)"
    outputs:
      - "dist"

  build-storybook:
    command: "bun run storybook build"
    inputs:
      - "@globs(sources)"
      - "@globs(configs)"
      - "@globs(tests)"
    outputs:
      - "storybook-static"

  # Quality tasks
  lint:
    command: "bun run eslint src/"
    inputs:
      - "@globs(sources)"
      - "eslint.config.js"
    outputs: []

  lint-fix:
    command: "bun run eslint src/ --fix"
    inputs:
      - "@globs(sources)"
      - "eslint.config.js"
    outputs: []

  typecheck:
    command: "bun run tsc --noEmit"
    inputs:
      - "@globs(sources)"
      - "tsconfig.json"
    outputs: []

  # Testing tasks
  test:
    command: "bun run storybook test --run"
    inputs:
      - "@globs(sources)"
      - "@globs(tests)"
      - "@globs(configs)"
    outputs:
      - "test-results"

  test-watch:
    command: "bun run storybook test --watch"
    local: true
    options:
      persistent: true
    inputs:
      - "@globs(sources)"
      - "@globs(tests)"
      - "@globs(configs)"
    outputs: []

  # Component generation
  generate-component:
    command: "bun run plop component"
    local: true
    options:
      interactive: true
    inputs: []
    outputs:
      - "src/components/**/*"

  # Clean tasks
  clean:
    command: "rm -rf dist storybook-static node_modules/.cache"
    inputs: []
    outputs: []

  clean-deps:
    command: "rm -rf node_modules bun.lockb"
    inputs: []
    outputs: []

  # Package management
  install:
    command: "bun install"
    inputs:
      - "package.json"
      - "bun.lockb"
    outputs:
      - "node_modules"

  # CI/CD tasks
  ci:
    deps:
      - "install"
      - "typecheck"
      - "lint"
      - "build"
      - "test"

  # Release preparation
  prepublish:
    deps:
      - "clean"
      - "install"
      - "ci"
      - "build-storybook"
